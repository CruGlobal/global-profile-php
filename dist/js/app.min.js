!function(){"use strict";angular.module("globalProfile",["ui.router","globalProfile.common.settingsService","globalProfile.api.measurements","globalProfile.states.selectMinistry","globalProfile.states.profile.edit","globalProfile.states.admin.add","globalProfile.states.admin.edit","globalProfile.states.admin.import"])}(),function(){"use strict";angular.module("globalProfile.api.measurements",["globalProfile.common.settingsService","ngResource"])}(),function(){"use strict";angular.module("globalProfile.states.admin",["ui.router","globalProfile.states.profile","globalProfile.api.measurements"]).config(["$stateProvider",function(e){e.state("admin",{parent:"profile",url:"/admin",resolve:{requiresLeader:["$q","isLeader",function(e,t){var r=e.defer();return t?r.resolve():r.reject("Not a Leader or Inherited Leader of the ministry."),r.promise}],people:["$log","ministry","Profile",function(e,t,r){return r.query({ministry_id:t.ministry_id}).$promise}]},views:{"@app":{templateUrl:"js/states/admin/admin.html"},"sidebar@admin":{templateUrl:"js/states/admin/sidebar.html",controller:"SidebarController"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.app",["ui.router","globalProfile.api.measurements"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("app",{"abstract":!0,url:"/",templateUrl:"js/states/app/app.html",resolve:{session:["$log","Session",function(e,t){return t.getSession()}],systems:["$log","session","Ministries",function(e,t,r){return r.systems().$promise}]}})}])}(),function(){"use strict";angular.module("globalProfile.states.profile",["ui.router","globalProfile.states.app","globalProfile.api.measurements"]).config(["$stateProvider",function(e){e.state("profile",{parent:"app","abstract":!0,url:"{min_code}",resolve:{ministry:["$log","$q","$state","$stateParams","session","systems",function(e,t,r,i,n,o){var s=t.defer();if(angular.isUndefined(i.min_code)||""===i.min_code)r.transitionTo("selectMinistry"),s.reject();else{var a=_.findWhere(o,{min_code:i.min_code});angular.isUndefined(a)?(r.transitionTo("selectMinistry"),s.reject()):s.resolve(a)}return s.promise}],isLeader:["$log","session","ministry",function(e,t,r){var i=function(e,t){var r=[];return angular.forEach(e,function(e){r.push(e),e.hasOwnProperty(t)&&angular.isArray(e[t])&&(r=r.concat(i(e[t],t)))}),r},n=_.where(i(t.assignments,"sub_ministries"),{ministry_id:r.ministry_id}),o=_.pluck(n,"team_role");return _.contains(o,"leader")||_.contains(o,"inherited_leader")}]},views:{"title@app":{controller:["$scope","ministry",function(e,t){e.ministry=t}],template:"{{ministry.name}}"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.selectMinistry",["ui.router","ui.bootstrap","globalProfile.states.app"]).config(["$stateProvider",function(e){e.state("selectMinistry",{parent:"app",url:"",templateUrl:"js/states/select-ministry/select-ministry.html",controller:"SelectMinistryController"})}])}(),function(){"use strict";angular.module("globalProfile.states.admin.add",["ui.router","globalProfile.states.admin","globalProfile.api.measurements","globalProfile.components.profileFormDirective"]).config(["$stateProvider",function(e){e.state("admin.add",{url:"/add",resolve:{profile:["$log","Profile",function(e,t){return t.defaultProfile()}]},views:{"content@admin":{templateUrl:"js/states/admin/add/add.html",controller:"AddProfileController"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.admin.import",["ui.router","globalProfile.states.admin","globalProfile.common.fileReaderDirective","globalProfile.common.offsetFilter"]).config(["$stateProvider",function(e){e.state("admin.import",{url:"/import",resolve:{},views:{"@app":{templateUrl:"js/states/admin/import/import.html",controller:"ImportCSVController"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.admin.edit",["ui.router","ui.bootstrap.modal","globalProfile.states.admin","globalProfile.components.profileFormDirective"]).config(["$stateProvider",function(e){e.state("admin.edit",{url:"/{person_ID:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}",resolve:{profile:["$log","$q","$stateParams","people",function(e,t,r,i){var n=t.defer();if(angular.isUndefined(r.person_ID)||""===r.person_ID)n.reject("Missing or Invalid person_id");else{var o=_.findWhere(i,{person_id:r.person_ID});angular.isUndefined(o)?($state.go("admin.new"),n.reject()):n.resolve(o)}return n.promise}]},views:{"content@admin":{templateUrl:"js/states/admin/edit/edit.html",controller:"EditProfileController"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.profile.edit",["ui.router","globalProfile.states.profile","globalProfile.api.measurements","globalProfile.components.profileFormDirective"]).config(["$stateProvider",function(e){e.state("edit",{parent:"profile",url:"",resolve:{profile:["$log","$q","session","ministry","Profile",function(e,t,r,i,n){var o=t.defer();return n.get({person_id:r.user.person_id,ministry_id:i.ministry_id},function(e){o.resolve(e)},function(e){if(404===e.status){var t=r.user,i=["cas_username","key_guid","first_name","last_name","person_id"],s=n.defaultProfile();angular.forEach(i,function(e){this["cas_username"===e?"email":"property"]=t.hasOwnProperty(e)?t[e]:""},s),o.resolve(s)}else o.reject(e)}),o.promise}]},views:{"@app":{templateUrl:"js/states/profile/edit/edit.html",controller:"EditPersonalProfileController"},"navigation@app":{controller:["$scope","isLeader",function(e,t){e.isLeader=t}],template:'<button type="button" class="btn btn-sm btn-danger" ng-if="isLeader" ui-sref="admin">Administrator</button>'}}})}])}(),function(e){"use strict";e.config(["SettingsProvider",function(e){e.setConfig(window.globalProfile.config)}]),e.config(["$logProvider","SettingsProvider",function(e,t){e.debugEnabled(t.isDebug())}]),e.config(["$httpProvider",function(e){e.interceptors.push("Session")}])}(angular.module("globalProfile")),function(e){"use strict";e.directive("fileReader",[function(){return{restrict:"A",scope:{fileReader:"="},link:function(e,t,r){t.on("change",function(t){e.$apply(function(){e.fileReader=t.target.files[0]})})}}}])}(angular.module("globalProfile.common.fileReaderDirective",[])),function(e){"use strict";e.filter("offset",function(){return function(e,t){return angular.isUndefined(e)?void 0:(t=parseInt(t,10),e.slice(t))}})}(angular.module("globalProfile.common.offsetFilter",[])),function(e){"use strict";e.provider("Settings",function(){function e(e,t){return"undefined"==typeof t?e:0===t.indexOf("/")?e+t:e+"/"+t}var t={};this.setConfig=function(e){t=e},this.isDebug=function(){return"development"===t.environment},this.$get=function(){return{api:{measurements:function(r){return e(t.api.measurements,r)}},ticket:t.ticket}}})}(angular.module("globalProfile.common.settingsService",[])),function(e){"use strict";e.module("globalProfile.directives",[])}(angular),function(e){e.directive("rtlOptions",["$parse",function(e){var t=function(e,t,r,i,n){for(var o=r.find("option"),s=0,a=0;s<o.length;s++){var l=angular.element(o[s]);if(""!=l.val()){var u={};u[t]=i[a],l.attr("dir",n(e,u)?"rtl":"ltr"),a++}}};return{priority:0,require:"ngModel",link:function(r,i,n,o){var s=n.rtlOptions.match(/^\s*(.+)\s+for\s+(.+)\s+in\s+(.+)?\s*/),a=s[3],l=e(s[1]);r.$watch(a,function(e,n){e&&t(r,s[2],i,e,l)},!0),r.$watch(n.ngModel,function(n,o){var u=e(a)(r);n&&t(r,s[2],i,u,l)})}}}])}(angular.module("globalProfile.directives")),function(e){"use strict";e.factory("Countries",["$log","$http","Settings",function(e,t,r){return{countries:function(){return t.get(r.api.measurements("/iso_countries"),{cache:!0}).then(function(e){return e.data})}}}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.factory("Languages",["$log","$http","Settings",function(e,t,r){return{languages:function(){return t.get(r.api.measurements("/languages"),{cache:!0}).then(function(e){return e.data})}}}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.factory("Ministries",["$log","$resource","Settings",function(e,t,r){return t(r.api.measurements("/ministries/:ministry_id"),{},{systems:{method:"GET",isArray:!0,params:{global_profile_only:"true"},cache:!0},query:{method:"GET",isArray:!0}})}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.factory("Profile",["$log","$resource","Settings",function(e,t,r){var i=t(r.api.measurements("/people/:person_id"),{person_id:"@person_id",ministry_id:"@ministry_id"},{get:{method:"GET"},query:{method:"GET",isArray:!0},create:{method:"POST"},update:{method:"PUT"}});return i.defaultProfile=function(){return{is_secure:!1}},i}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.factory("Session",["$injector","$q","$log","Settings",function(e,t,r,i){var n,o;return{getSession:function(){var r=t.defer();return angular.isDefined(o)?r.resolve(o):e.get("$http").get(i.api.measurements("/token"),{params:{st:i.ticket}}).then(function(e){n=e.data.session_ticket,o=e.data,r.resolve(o)},function(e){r.reject(e)}),r.promise},request:function(e){return 0===e.url.indexOf(i.api.measurements())&&(r.debug("Measurements API Request",e),e.withCredentials=!0,angular.isUndefined(n)||(e.headers.Authorization="Bearer "+n)),e},responseError:function(e){return t.reject(e)}}}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.directive("profileForm",["$log","Languages","Countries",function(e,t,r){var i=["cas_username","last_name","first_name","gender","birth_date","marital_status","language","is_secure","mcc","staff_status","funding_source","employment_country","ministry_location_country","date_joined_staff","role","scope"];return{restrict:"E",require:["^ngModel"],scope:{profile:"=ngModel",requiredFields:"=?profileRequiredFields"},templateUrl:"js/components/profile-form/profile-form.html",transclude:!0,link:function(e,n,o){t.languages().then(function(t){e.languages=t}),r.countries().then(function(t){e.countries=t}),e.showHelp=e.$eval(o.profileShowHelp)!==!1,e.showLeftStaff=e.$eval(o.profileShowLeftStaff)===!0,angular.isUndefined(o.profileRequiredFields)&&(e.requiredFields=i),e.isRequired=function(t){return e.requiredFields.indexOf(t)>-1}}}}])}(angular.module("globalProfile.components.profileFormDirective",["globalProfile.api.measurements"])),function(e){"use strict";e.controller("SidebarController",["$log","$scope","$state","people",function(e,t,r,i){t.$state=r,t.people=i,t.filterText="",t.clearFilter=function(){t.filterText=""}}])}(angular.module("globalProfile.states.admin")),function(e){"use strict";e.controller("SelectMinistryController",["$log","$scope","$state","session","systems",function(e,t,r,i,n){function o(e,t){var r=[];return angular.forEach(e,function(e){r.push(e),e.hasOwnProperty(t)&&angular.isArray(e[t])&&(r=r.concat(o(e[t],t)))}),r}var s=o(i.assignments,"sub_ministries");t.$state=r,t.ministries=n,t.isLeader=function(e){var t=_.pluck(_.where(s,{ministry_id:e}),"team_role");return _.contains(t,"leader")||_.contains(t,"inherited_leader")}}])}(angular.module("globalProfile.states.selectMinistry")),function(e){"use strict";e.controller("AddProfileController",["$log","$scope","$state","profile","ministry","Profile",function(e,t,r,i,n,o){t.$state=r,t.requiredFields=["cas_username","last_name","first_name","gender","birth_date","marital_status","language","is_secure","mcc","staff_status","funding_source","employment_country","ministry_location_country","date_joined_staff","role","scope"],t.profile=angular.copy(i),t.resetForm=function(){t.profile=angular.copy(i)},t.saveProfile=function(){o.create({ministry_id:n.ministry_id},t.profile,function(e){r.go("admin.edit",{person_ID:e.person_id},{reload:!0})},function(){e.error("Error Saving Profile")})},t.$on("$stateChangeStart",function(e,i,n,o,s){t.profileForm.$dirty&&(e.preventDefault(),$modal.open({templateUrl:"js/states/admin/unsaved.modal.html",controller:["$scope","$modalInstance",function(e,t){e.save=function(){t.close()},e.cancel=function(){t.dismiss("discard")}}]}).result.then(function(){},function(e){"discard"===e&&(t.profileForm.$setPristine(),r.transitionTo(i,n))}))})}])}(angular.module("globalProfile.states.admin.add")),function(e){"use strict";e.controller("ImportCSVController",["$log","$scope","$state","ministry","Profile",function(e,t,r,i,n){function o(){angular.isUndefined(t.file)||angular.isUndefined(t.hasHeader)||Papa.parse(t.file,{header:!1,complete:function(e,r){var i=[];t.$apply(function(){if(t.hasHeader){t.headerRow=e.data.shift();for(var r=0;r<t.headerRow.length;r++)i.push({index:r})}else{delete t.headerRow;for(var r=0;r<e.data[0].length;r++)i.push({index:r})}t.columns=i,t.csv=e})}})}t.$state=r,t.hasHeader=!0,t.columns=[],t.pager={page:1,begin:0},t.browse=function(){document.getElementById("fileBrowser").click()},t.$watch("file",function(e){angular.isUndefined(e)||o()}),t.$watch("hasHeader",function(e){o()}),t.$watch("pager.page",function(e){angular.isUndefined(t.csv)||(t.pager.begin=10*(e-1))})}])}(angular.module("globalProfile.states.admin.import")),function(e){"use strict";e.controller("EditProfileController",["$log","$scope","$state","profile","ministry","Profile","$modal",function(e,t,r,i,n,o,s){t.$state=r,t.requiredFields=["cas_username","last_name","first_name","gender","birth_date","marital_status","language","is_secure","mcc","staff_status","funding_source","employment_country","ministry_location_country","date_joined_staff","role","scope"],t.profile=angular.copy(i),t.resetForm=function(){t.profile=angular.copy(i),t.profileForm.$setPristine()},t.saveChanges=function(){o.update({ministry_id:n.ministry_id},t.profile,function(e){i=e,t.profile=angular.copy(i),t.profileForm.$setPristine()},function(){e.error("Error Saving Profile")})},t.$on("$stateChangeStart",function(e,i,n,o,a){t.profileForm.$dirty&&(e.preventDefault(),s.open({templateUrl:"js/states/admin/unsaved.modal.html",controller:["$scope","$modalInstance",function(e,t){e.save=function(){t.close()},e.cancel=function(){t.dismiss("discard")}}]}).result.then(function(){},function(e){"discard"===e&&(t.profileForm.$setPristine(),r.transitionTo(i,n))}))})}])}(angular.module("globalProfile.states.admin.edit")),function(e){"use strict";e.controller("EditPersonalProfileController",["$log","$scope","session","ministry","profile","Profile",function(e,t,r,i,n,o){t.profile=angular.copy(n),t.resetForm=function(){t.profile=angular.copy(n),t.profileForm.$setPristine()},t.saveChanges=function(){var e=angular.isUndefined(n.id)?"create":"update";o[e]({ministry_id:i.ministry_id},t.profile,function(e){n=e,t.profile=angular.copy(n),t.profileForm.$setPristine()})}}])}(angular.module("globalProfile.states.profile.edit"));
//# sourceMappingURL=app.min.js.map