!function(){"use strict";angular.module("globalProfile",["ui.router","globalProfile.common.settingsService","globalProfile.api.measurements","globalProfile.states.selectMinistry","globalProfile.states.profile.edit","globalProfile.states.admin.add","globalProfile.states.admin.edit","globalProfile.states.admin.import"])}(),function(){"use strict";angular.module("globalProfile.api.measurements",["globalProfile.common.settingsService","ngResource"])}(),function(){"use strict";angular.module("globalProfile.states.admin",["ui.router","globalProfile.states.profile","globalProfile.api.measurements"]).config(["$stateProvider",function(e){e.state("admin",{parent:"profile",url:"/admin",resolve:{requiresLeader:["$q","isLeader",function(e,t){var i=e.defer();return t?i.resolve():i.reject("Not a Leader or Inherited Leader of the ministry."),i.promise}],people:["$log","ministry","Profile",function(e,t,i){return i.query({ministry_id:t.ministry_id}).$promise}]},views:{"@app":{templateUrl:"js/states/admin/admin.html"},"sidebar@admin":{templateUrl:"js/states/admin/sidebar.html",controller:"SidebarController"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.app",["ui.router","globalProfile.api.measurements"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("app",{"abstract":!0,url:"/",templateUrl:"js/states/app/app.html",resolve:{session:["$log","Session",function(e,t){return t.getSession()}],systems:["$log","session","Ministries",function(e,t,i){return i.systems().$promise}],ministries:["$log","session","Ministries",function(e,t,i){return i.whq().$promise}],languages:["$log","session","Languages",function(e,t,i){return i.languages()}],countries:["$log","session","Countries",function(e,t,i){return i.countries()}]}})}])}(),function(){"use strict";angular.module("globalProfile.states.profile",["ui.router","globalProfile.states.app","globalProfile.api.measurements"]).config(["$stateProvider",function(e){e.state("profile",{parent:"app","abstract":!0,url:"{min_code}",resolve:{ministry:["$log","$q","$state","$stateParams","session","systems",function(e,t,i,r,n,o){var s=t.defer();if(angular.isUndefined(r.min_code)||""===r.min_code)i.transitionTo("selectMinistry"),s.reject();else{var a=_.findWhere(o,{min_code:r.min_code});angular.isUndefined(a)?(i.transitionTo("selectMinistry"),s.reject()):s.resolve(a)}return s.promise}],isLeader:["$log","session","ministry",function(e,t,i){var r=function(e,t){var i=[];return angular.forEach(e,function(e){i.push(e),e.hasOwnProperty(t)&&angular.isArray(e[t])&&(i=i.concat(r(e[t],t)))}),i},n=_.where(r(t.assignments,"sub_ministries"),{ministry_id:i.ministry_id}),o=_.pluck(n,"team_role");return _.contains(o,"leader")||_.contains(o,"inherited_leader")}]},views:{"title@app":{controller:["$scope","ministry",function(e,t){e.ministry=t}],template:"{{ministry.name}}"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.selectMinistry",["ui.router","ui.bootstrap","globalProfile.states.app"]).config(["$stateProvider",function(e){e.state("selectMinistry",{parent:"app",url:"",templateUrl:"js/states/select-ministry/select-ministry.html",controller:"SelectMinistryController"})}])}(),function(){"use strict";angular.module("globalProfile.states.admin.add",["ui.router","ui.bootstrap.modal","globalProfile.states.admin","globalProfile.api.measurements","globalProfile.components.profileFormDirective"]).config(["$stateProvider",function(e){e.state("admin.add",{url:"/add",resolve:{profile:["$log","Profile",function(e,t){return t.defaultProfile()}]},views:{"content@admin":{templateUrl:"js/states/admin/add/add.html",controller:"AddProfileController"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.admin.edit",["ui.router","ui.bootstrap.modal","globalProfile.states.admin","globalProfile.components.profileFormDirective"]).config(["$stateProvider",function(e){e.state("admin.edit",{url:"/{person_ID:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}",resolve:{profile:["$log","$q","$stateParams","people",function(e,t,i,r){var n=t.defer();if(angular.isUndefined(i.person_ID)||""===i.person_ID)n.reject("Missing or Invalid person_id");else{var o=_.findWhere(r,{person_id:i.person_ID});angular.isUndefined(o)?($state.go("admin.new"),n.reject()):n.resolve(o)}return n.promise}]},views:{"content@admin":{templateUrl:"js/states/admin/edit/edit.html",controller:"EditProfileController"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.admin.import",["ui.router","globalProfile.states.admin","globalProfile.common.fileReaderDirective","globalProfile.common.offsetFilter"]).config(["$stateProvider",function(e){e.state("admin.import",{url:"/import",resolve:{},views:{"@app":{templateUrl:"js/states/admin/import/import.html",controller:"ImportCSVController"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.profile.edit",["ui.router","ui.bootstrap.modal","globalProfile.states.profile","globalProfile.api.measurements","globalProfile.components.profileFormDirective"]).config(["$stateProvider",function(e){e.state("edit",{parent:"profile",url:"",resolve:{profile:["$log","$q","session","ministry","Profile",function(e,t,i,r,n){var o=t.defer();return n.get({person_id:i.user.person_id,ministry_id:r.ministry_id},function(e){o.resolve(e)},function(e){if(404===e.status){var t=i.user,r=["key_username","key_guid","first_name","last_name","person_id"],s=n.defaultProfile();angular.forEach(r,function(e){this["key_username"===e?"email":e]=t.hasOwnProperty(e)?t[e]:""},s),o.resolve(s)}else o.reject(e)}),o.promise}]},views:{"@app":{templateUrl:"js/states/profile/edit/edit.html",controller:"EditPersonalProfileController"},"navigation@app":{controller:["$scope","isLeader",function(e,t){e.isLeader=t}],template:'<button type="button" class="btn btn-sm btn-danger" ng-if="isLeader" ui-sref="admin">Administrator</button>'}}})}])}(),function(e){"use strict";e.config(["$locationProvider",function(e){e.html5Mode(!0)}]),e.config(["SettingsProvider",function(e){e.setConfig(window.globalProfile.config)}]),e.config(["$logProvider","SettingsProvider",function(e,t){e.debugEnabled(t.isDebug())}]),e.config(["$httpProvider",function(e){e.interceptors.push("Session")}])}(angular.module("globalProfile")),function(e){"use strict";e.directive("fileReader",[function(){return{restrict:"A",scope:{fileReader:"="},link:function(e,t,i){t.on("change",function(t){e.$apply(function(){e.fileReader=t.target.files[0]})})}}}])}(angular.module("globalProfile.common.fileReaderDirective",[])),function(e){"use strict";e.filter("offset",function(){return function(e,t){return angular.isUndefined(e)?void 0:(t=parseInt(t,10),e.slice(t))}})}(angular.module("globalProfile.common.offsetFilter",[])),function(e){"use strict";e.provider("Settings",function(){function e(e,t){return"undefined"==typeof t?e:0===t.indexOf("/")?e+t:e+"/"+t}var t={};this.setConfig=function(e){t=e},this.isDebug=function(){return"development"===t.environment},this.$get=function(){return{api:{measurements:function(i){return e(t.api.measurements,i)}},ticket:t.ticket}}})}(angular.module("globalProfile.common.settingsService",[])),function(e){"use strict";e.module("globalProfile.directives",[])}(angular),function(e){"use strict";e.factory("Countries",["$log","$http","Settings",function(e,t,i){return{countries:function(){return t.get(i.api.measurements("/iso_countries"),{cache:!0}).then(function(e){if(angular.isArray(e.data))return e.data;var t=[];return angular.forEach(e.data,function(e,t){this.push({iso3:t,name:e})},t),t})}}}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.factory("Languages",["$log","$http","Settings",function(e,t,i){return{languages:function(){return t.get(i.api.measurements("/languages"),{cache:!0}).then(function(e){return e.data})}}}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.factory("Ministries",["$log","$resource","Settings",function(e,t,i){return t(i.api.measurements("/ministries/:ministry_id"),{},{systems:{method:"GET",isArray:!0,params:{global_profile_only:"true"},cache:!0},whq:{method:"GET",isArray:!0,params:{whq_only:"true"},cache:!0},query:{method:"GET",isArray:!0}})}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.factory("Profile",["$log","$resource","Settings",function(e,t,i){var r=function(e){return angular.isUndefined(e.language)?e.language=[]:angular.isString(e.language)&&(e.language=[e.language]),angular.isUndefined(e.assignments)&&(e.assignments=[{}]),e},n=function(e,t){return angular.forEach(e,function(t,i){(angular.isUndefined(t)||null===t)&&delete e[i]}),angular.isObject(e)?angular.toJson(e):e},o=t(i.api.measurements("/people/:person_id"),{person_id:"@person_id",ministry_id:"@ministry_id"},{get:{method:"GET",interceptor:{response:function(e){return r(e.resource)}}},query:{method:"GET",isArray:!0,interceptor:{response:function(e){return angular.forEach(e.resource,r)}}},create:{method:"POST",transformRequest:n},update:{method:"PUT",transformRequest:n}});return o.defaultProfile=function(){return r({is_secure:!1})},o}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.factory("Session",["$injector","$q","$log","Settings",function(e,t,i,r){var n,o;return{getSession:function(){var i=t.defer();return angular.isDefined(o)?i.resolve(o):e.get("$http").get(r.api.measurements("/token"),{params:{st:r.ticket}}).then(function(e){n=e.data.session_ticket,o=e.data,i.resolve(o)},function(e){i.reject(e)}),i.promise},request:function(e){return 0===e.url.indexOf(r.api.measurements())&&(i.debug("Measurements API Request",e),e.withCredentials=!0,angular.isUndefined(n)||(e.headers.Authorization="Bearer "+n)),e},responseError:function(e){return t.reject(e)}}}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.directive("profileForm",["$log","Languages","Countries","Ministries",function(e,t,i,r){var n=["email","last_name","first_name","gender","birth_date","marital_status","country_of_residence","language1","organizational_status","funding_source","date_joined_staff","ministry_of_employment","assignment_ministry","mcc","position_role","scope"];return{restrict:"E",require:["^ngModel"],scope:{profile:"=ngModel",requiredFields:"=?profileRequiredFields",ministries:"=profileMinistries",languages:"=profileLanguages",countries:"=profileCountries"},templateUrl:"js/components/profile-form/profile-form.html",transclude:!0,link:function(e,t,i){e.showHelp=angular.isUndefined(i.profileShowHelp)?!0:e.$eval(i.profileShowHelp)===!0,e.showPrivacy=e.$eval(i.profileShowPrivacy)===!0,e.showLeftStaff=e.$eval(i.profileShowLeftStaff)===!0,angular.isUndefined(i.profileRequiredFields)&&(e.requiredFields=n),e.isRequired=function(t){return e.requiredFields.indexOf(t)>-1},e.$watch("profile.organizational_status",function(t,i){angular.isUndefined(t)||"Volunteer"==t||"Other"==t?(e.showStaffDates=!1,e.requiredFields=_.without(e.requiredFields,"date_joined_staff")):(e.showStaffDates=!0,-1===_.indexOf(e.requiredFields,"date_joined_staff")&&e.requiredFields.push("date_joined_staff"))}),e.$watch("profile.organizational_status",function(t,i){"Other"!==e.profile.funding_source&&(angular.isUndefined(t)||"Volunteer"==t?(e.showEmploymentMinistry=!1,e.requiredFields=_.without(e.requiredFields,"ministry_of_employment")):(e.showEmploymentMinistry=!0,-1===_.indexOf(e.requiredFields,"ministry_of_employment")&&e.requiredFields.push("ministry_of_employment")))}),e.$watch("profile.funding_source",function(t,i){"Volunteer"!==e.profile.organizational_status&&(angular.isUndefined(t)||"Other"==t?(e.showEmploymentMinistry=!1,e.requiredFields=_.without(e.requiredFields,"ministry_of_employment")):(e.showEmploymentMinistry=!0,-1===_.indexOf(e.requiredFields,"ministry_of_employment")&&e.requiredFields.push("ministry_of_employment")))}),e.formatMinistryLabel=function(t){for(var i=0;i<e.ministries.length;i++)if(t===e.ministries[i].ministry_id)return e.ministries[i].area_code+" — "+e.ministries[i].name},e.formatCountryLabel=function(t){for(var i=0;i<e.countries.length;i++)if(t===e.countries[i].iso3)return e.countries[i].name}}}}])}(angular.module("globalProfile.components.profileFormDirective",["globalProfile.api.measurements"])),function(e){"use strict";e.controller("SidebarController",["$log","$scope","$state","people",function(e,t,i,r){t.$state=i,t.people=r,t.filterText="",t.clearFilter=function(){t.filterText=""}}])}(angular.module("globalProfile.states.admin")),function(e){"use strict";e.controller("SelectMinistryController",["$log","$scope","$state","session","systems",function(e,t,i,r,n){function o(e,t){var i=[];return angular.forEach(e,function(e){i.push(e),e.hasOwnProperty(t)&&angular.isArray(e[t])&&(i=i.concat(o(e[t],t)))}),i}var s=o(r.assignments,"sub_ministries");t.$state=i,t.ministries=n,t.isLeader=function(e){var t=_.pluck(_.where(s,{ministry_id:e}),"team_role");return _.contains(t,"leader")||_.contains(t,"inherited_leader")}}])}(angular.module("globalProfile.states.selectMinistry")),function(e){"use strict";e.controller("AddProfileController",["$log","$scope","$modal","$state","profile","ministry","Profile","ministries","countries","languages",function(e,t,i,r,n,o,s,a,l,u){t.$state=r,t.requiredFields=["email","last_name","first_name","gender","birth_date","marital_status","country_of_residence","language1","organizational_status","funding_source","date_joined_staff","ministry_of_employment","assignment_ministry","mcc","position_role","scope"],t.profile=angular.copy(n),t.ministries=a,t.countries=l,t.languages=u,t.resetForm=function(){t.profile=angular.copy(n)},t.saveProfile=function(){s.create({ministry_id:o.ministry_id},t.profile,function(e){t.profileForm.$setPristine(),r.go("admin.edit",{person_ID:e.person_id},{reload:!0})},function(){i.open({templateUrl:"js/states/admin/error.modal.html",size:"sm",controller:["$scope","$modalInstance",function(e,t){e.ok=function(){t.close()}}]})})},t.$on("$stateChangeStart",function(e,n,o,s,a){t.profileForm.$dirty&&(e.preventDefault(),i.open({templateUrl:"js/states/admin/unsaved.modal.html",controller:["$scope","$modalInstance",function(e,t){e.save=function(){t.close()},e.cancel=function(){t.dismiss("discard")}}]}).result.then(function(){},function(e){"discard"===e&&(t.profileForm.$setPristine(),r.transitionTo(n,o))}))})}])}(angular.module("globalProfile.states.admin.add")),function(e){"use strict";e.controller("EditProfileController",["$log","$scope","$state","profile","ministry","Profile","$modal","ministries","countries","languages",function(e,t,i,r,n,o,s,a,l,u){t.$state=i,t.requiredFields=["email","last_name","first_name","gender","birth_date","marital_status","country_of_residence","language1","organizational_status","funding_source","date_joined_staff","ministry_of_employment","assignment_ministry","mcc","position_role","scope"],t.profile=angular.copy(r),t.ministries=a,t.countries=l,t.languages=u,t.resetForm=function(){t.profile=angular.copy(r),t.profileForm.$setPristine()},t.saveChanges=function(){o.update({ministry_id:n.ministry_id},t.profile,function(e){r=e,t.profile=angular.copy(r),t.profileForm.$setPristine()},function(){s.open({templateUrl:"js/states/admin/error.modal.html",size:"sm",controller:["$scope","$modalInstance",function(e,t){e.ok=function(){t.close()}}]})})},t.$on("$stateChangeStart",function(e,r,n,o,a){t.profileForm.$dirty&&(e.preventDefault(),s.open({templateUrl:"js/states/admin/unsaved.modal.html",controller:["$scope","$modalInstance",function(e,t){e.save=function(){t.close()},e.cancel=function(){t.dismiss("discard")}}]}).result.then(function(){},function(e){"discard"===e&&(t.profileForm.$setPristine(),i.transitionTo(r,n))}))})}])}(angular.module("globalProfile.states.admin.edit")),function(e){"use strict";e.controller("ImportCSVController",["$log","$scope","$state","ministry","Profile",function(e,t,i,r,n){function o(){angular.isUndefined(t.file)||angular.isUndefined(t.hasHeader)||Papa.parse(t.file,{header:!1,complete:function(e,i){var r=[];t.$apply(function(){if(t.hasHeader){t.headerRow=e.data.shift();for(var i=0;i<t.headerRow.length;i++)r.push({index:i})}else{delete t.headerRow;for(var i=0;i<e.data[0].length;i++)r.push({index:i})}t.columns=r,t.csv=e})}})}t.$state=i,t.hasHeader=!0,t.columns=[],t.pager={page:1,begin:0},t.browse=function(){document.getElementById("fileBrowser").click()},t.$watch("file",function(e){angular.isUndefined(e)||o()}),t.$watch("hasHeader",function(e){o()}),t.$watch("pager.page",function(e){angular.isUndefined(t.csv)||(t.pager.begin=10*(e-1))})}])}(angular.module("globalProfile.states.admin.import")),function(e){"use strict";e.controller("EditPersonalProfileController",["$log","$scope","$modal","session","ministry","profile","Profile","ministries","countries","languages",function(e,t,i,r,n,o,s,a,l,u){t.profile=angular.copy(o),t.ministries=a,t.countries=l,t.languages=u,t.resetForm=function(){t.profile=angular.copy(o),t.profileForm.$setPristine()},t.saveChanges=function(){var e=angular.isUndefined(o.id)?"create":"update";s[e]({ministry_id:n.ministry_id},t.profile,function(e){o=e,t.profile=angular.copy(o),t.profileForm.$setPristine()},function(){i.open({templateUrl:"js/states/admin/error.modal.html",size:"sm",controller:["$scope","$modalInstance",function(e,t){e.ok=function(){t.close()}}]})})}}])}(angular.module("globalProfile.states.profile.edit"));
//# sourceMappingURL=app.min.js.map