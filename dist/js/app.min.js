!function(){"use strict";angular.module("globalProfile",["ui.router","globalProfile.common.settingsService","globalProfile.api.measurements","globalProfile.states.selectMinistry","globalProfile.states.profile.edit","globalProfile.states.admin.add","globalProfile.states.admin.edit","globalProfile.states.admin.import"])}(),function(){"use strict";angular.module("globalProfile.api.measurements",["globalProfile.common.settingsService","ngResource"])}(),function(){"use strict";angular.module("globalProfile.states.admin",["ui.router","globalProfile.states.profile","globalProfile.api.measurements"]).config(["$stateProvider",function(e){e.state("admin",{parent:"profile",url:"/admin",resolve:{requiresLeader:["$q","isLeader",function(e,i){var t=e.defer();return i?t.resolve():t.reject("Not a Leader or Inherited Leader of the ministry."),t.promise}],people:["$log","ministry","Profile",function(e,i,t){return t.query({ministry_id:i.ministry_id}).$promise}]},views:{"@app":{templateUrl:"js/states/admin/admin.html"},"sidebar@admin":{templateUrl:"js/states/admin/sidebar.html",controller:"SidebarController"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.app",["ui.router","globalProfile.api.measurements"]).config(["$stateProvider","$urlRouterProvider",function(e,i){i.otherwise("/"),e.state("app",{"abstract":!0,url:"/",templateUrl:"js/states/app/app.html",resolve:{session:["$log","Session",function(e,i){return i.getSession()}],systems:["$log","session","Ministries",function(e,i,t){return t.systems().$promise}],ministries:["$log","session","Ministries",function(e,i,t){return t.whq().$promise}],languages:["$log","session","Languages",function(e,i,t){return t.languages()}],countries:["$log","session","Countries",function(e,i,t){return t.countries()}]}})}])}(),function(){"use strict";angular.module("globalProfile.states.profile",["ui.router","globalProfile.states.app","globalProfile.api.measurements"]).config(["$stateProvider",function(e){e.state("profile",{parent:"app","abstract":!0,url:"{min_code}",resolve:{ministry:["$log","$q","$state","$stateParams","session","systems",function(e,i,t,r,n,o){var s=i.defer();if(angular.isUndefined(r.min_code)||""===r.min_code)t.transitionTo("selectMinistry"),s.reject();else{var a=_.findWhere(o,{min_code:r.min_code});angular.isUndefined(a)?(t.transitionTo("selectMinistry"),s.reject()):s.resolve(a)}return s.promise}],isLeader:["$log","session","ministry",function(e,i,t){var r=function(e,i){var t=[];return angular.forEach(e,function(e){t.push(e),e.hasOwnProperty(i)&&angular.isArray(e[i])&&(t=t.concat(r(e[i],i)))}),t},n=_.where(r(i.assignments,"sub_ministries"),{ministry_id:t.ministry_id}),o=_.pluck(n,"team_role");return _.contains(o,"leader")||_.contains(o,"inherited_leader")}]},views:{"title@app":{controller:["$scope","ministry",function(e,i){e.ministry=i}],template:"{{ministry.name}}"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.selectMinistry",["ui.router","ui.bootstrap","globalProfile.states.app"]).config(["$stateProvider",function(e){e.state("selectMinistry",{parent:"app",url:"",templateUrl:"js/states/select-ministry/select-ministry.html",controller:"SelectMinistryController"})}])}(),function(){"use strict";angular.module("globalProfile.states.admin.add",["ui.router","globalProfile.states.admin","globalProfile.api.measurements","globalProfile.components.profileFormDirective"]).config(["$stateProvider",function(e){e.state("admin.add",{url:"/add",resolve:{profile:["$log","Profile",function(e,i){return i.defaultProfile()}]},views:{"content@admin":{templateUrl:"js/states/admin/add/add.html",controller:"AddProfileController"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.admin.edit",["ui.router","ui.bootstrap.modal","globalProfile.states.admin","globalProfile.components.profileFormDirective"]).config(["$stateProvider",function(e){e.state("admin.edit",{url:"/{person_ID:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}}",resolve:{profile:["$log","$q","$stateParams","people",function(e,i,t,r){var n=i.defer();if(angular.isUndefined(t.person_ID)||""===t.person_ID)n.reject("Missing or Invalid person_id");else{var o=_.findWhere(r,{person_id:t.person_ID});angular.isUndefined(o)?($state.go("admin.new"),n.reject()):n.resolve(o)}return n.promise}]},views:{"content@admin":{templateUrl:"js/states/admin/edit/edit.html",controller:"EditProfileController"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.admin.import",["ui.router","globalProfile.states.admin","globalProfile.common.fileReaderDirective","globalProfile.common.offsetFilter"]).config(["$stateProvider",function(e){e.state("admin.import",{url:"/import",resolve:{},views:{"@app":{templateUrl:"js/states/admin/import/import.html",controller:"ImportCSVController"}}})}])}(),function(){"use strict";angular.module("globalProfile.states.profile.edit",["ui.router","globalProfile.states.profile","globalProfile.api.measurements","globalProfile.components.profileFormDirective"]).config(["$stateProvider",function(e){e.state("edit",{parent:"profile",url:"",resolve:{profile:["$log","$q","session","ministry","Profile",function(e,i,t,r,n){var o=i.defer();return n.get({person_id:t.user.person_id,ministry_id:r.ministry_id},function(e){o.resolve(e)},function(e){if(404===e.status){var i=t.user,r=["key_username","key_guid","first_name","last_name","person_id"],s=n.defaultProfile();angular.forEach(r,function(e){this["key_username"===e?"email":e]=i.hasOwnProperty(e)?i[e]:""},s),o.resolve(s)}else o.reject(e)}),o.promise}]},views:{"@app":{templateUrl:"js/states/profile/edit/edit.html",controller:"EditPersonalProfileController"},"navigation@app":{controller:["$scope","isLeader",function(e,i){e.isLeader=i}],template:'<button type="button" class="btn btn-sm btn-danger" ng-if="isLeader" ui-sref="admin">Administrator</button>'}}})}])}(),function(e){"use strict";e.config(["$locationProvider",function(e){e.html5Mode(!0)}]),e.config(["SettingsProvider",function(e){e.setConfig(window.globalProfile.config)}]),e.config(["$logProvider","SettingsProvider",function(e,i){e.debugEnabled(i.isDebug())}]),e.config(["$httpProvider",function(e){e.interceptors.push("Session")}])}(angular.module("globalProfile")),function(e){"use strict";e.directive("fileReader",[function(){return{restrict:"A",scope:{fileReader:"="},link:function(e,i,t){i.on("change",function(i){e.$apply(function(){e.fileReader=i.target.files[0]})})}}}])}(angular.module("globalProfile.common.fileReaderDirective",[])),function(e){"use strict";e.filter("offset",function(){return function(e,i){return angular.isUndefined(e)?void 0:(i=parseInt(i,10),e.slice(i))}})}(angular.module("globalProfile.common.offsetFilter",[])),function(e){"use strict";e.provider("Settings",function(){function e(e,i){return"undefined"==typeof i?e:0===i.indexOf("/")?e+i:e+"/"+i}var i={};this.setConfig=function(e){i=e},this.isDebug=function(){return"development"===i.environment},this.$get=function(){return{api:{measurements:function(t){return e(i.api.measurements,t)}},ticket:i.ticket}}})}(angular.module("globalProfile.common.settingsService",[])),function(e){"use strict";e.module("globalProfile.directives",[])}(angular),function(e){"use strict";e.factory("Countries",["$log","$http","Settings",function(e,i,t){return{countries:function(){return i.get(t.api.measurements("/iso_countries"),{cache:!0}).then(function(e){if(angular.isArray(e.data))return e.data;var i=[];return angular.forEach(e.data,function(e,i){this.push({iso3:i,name:e})},i),i})}}}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.factory("Languages",["$log","$http","Settings",function(e,i,t){return{languages:function(){return i.get(t.api.measurements("/languages"),{cache:!0}).then(function(e){return e.data})}}}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.factory("Ministries",["$log","$resource","Settings",function(e,i,t){return i(t.api.measurements("/ministries/:ministry_id"),{},{systems:{method:"GET",isArray:!0,params:{global_profile_only:"true"},cache:!0},whq:{method:"GET",isArray:!0,params:{whq_only:"true"},cache:!0},query:{method:"GET",isArray:!0}})}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.factory("Profile",["$log","$resource","Settings",function(e,i,t){var r=function(e){return angular.isUndefined(e.language)?e.language=[]:angular.isString(e.language)&&(e.language=[e.language]),angular.isUndefined(e.assignments)&&(e.assignments=[{}]),e},n=function(e,i){return angular.forEach(e,function(i,t){(angular.isUndefined(i)||null===i)&&delete e[t]}),angular.isObject(e)?angular.toJson(e):e},o=i(t.api.measurements("/people/:person_id"),{person_id:"@person_id",ministry_id:"@ministry_id"},{get:{method:"GET",interceptor:{response:function(e){return r(e.resource)}}},query:{method:"GET",isArray:!0,interceptor:{response:function(e){return angular.forEach(e.resource,r)}}},create:{method:"POST",transformRequest:n},update:{method:"PUT",transformRequest:n}});return o.defaultProfile=function(){return r({is_secure:!1})},o}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.factory("Session",["$injector","$q","$log","Settings",function(e,i,t,r){var n,o;return{getSession:function(){var t=i.defer();return angular.isDefined(o)?t.resolve(o):e.get("$http").get(r.api.measurements("/token"),{params:{st:r.ticket}}).then(function(e){n=e.data.session_ticket,o=e.data,t.resolve(o)},function(e){t.reject(e)}),t.promise},request:function(e){return 0===e.url.indexOf(r.api.measurements())&&(t.debug("Measurements API Request",e),e.withCredentials=!0,angular.isUndefined(n)||(e.headers.Authorization="Bearer "+n)),e},responseError:function(e){return i.reject(e)}}}])}(angular.module("globalProfile.api.measurements")),function(e){"use strict";e.directive("profileForm",["$log","Languages","Countries","Ministries",function(e,i,t,r){var n=["email","last_name","first_name","gender","birth_date","marital_status","country_of_residence","language1","organizational_status","funding_source","date_joined_staff","ministry_of_employment","assignment_ministry","mcc","position_role","scope"];return{restrict:"E",require:["^ngModel"],scope:{profile:"=ngModel",requiredFields:"=?profileRequiredFields",ministries:"=profileMinistries",languages:"=profileLanguages",countries:"=profileCountries"},templateUrl:"js/components/profile-form/profile-form.html",transclude:!0,link:function(e,i,t){e.showHelp=angular.isUndefined(t.profileShowHelp)?!0:e.$eval(t.profileShowHelp)===!0,e.showPrivacy=e.$eval(t.profileShowPrivacy)===!0,e.showLeftStaff=e.$eval(t.profileShowLeftStaff)===!0,angular.isUndefined(t.profileRequiredFields)&&(e.requiredFields=n),e.isRequired=function(i){return e.requiredFields.indexOf(i)>-1},e.$watch("profile.organizational_status",function(i,t){angular.isUndefined(i)||"Volunteer"==i||"Other"==i?(e.showStaffDates=!1,e.requiredFields=_.without(e.requiredFields,"date_joined_staff")):(e.showStaffDates=!0,-1===_.indexOf(e.requiredFields,"date_joined_staff")&&e.requiredFields.push("date_joined_staff"))}),e.$watch("profile.organizational_status",function(i,t){"Other"!==e.profile.funding_source&&(angular.isUndefined(i)||"Volunteer"==i?(e.showEmploymentMinistry=!1,e.requiredFields=_.without(e.requiredFields,"ministry_of_employment")):(e.showEmploymentMinistry=!0,-1===_.indexOf(e.requiredFields,"ministry_of_employment")&&e.requiredFields.push("ministry_of_employment")))}),e.$watch("profile.funding_source",function(i,t){"Volunteer"!==e.profile.organizational_status&&(angular.isUndefined(i)||"Other"==i?(e.showEmploymentMinistry=!1,e.requiredFields=_.without(e.requiredFields,"ministry_of_employment")):(e.showEmploymentMinistry=!0,-1===_.indexOf(e.requiredFields,"ministry_of_employment")&&e.requiredFields.push("ministry_of_employment")))}),e.formatMinistryLabel=function(i){for(var t=0;t<e.ministries.length;t++)if(i===e.ministries[t].ministry_id)return e.ministries[t].area_code+" — "+e.ministries[t].name},e.formatCountryLabel=function(i){for(var t=0;t<e.countries.length;t++)if(i===e.countries[t].iso3)return e.countries[t].name}}}}])}(angular.module("globalProfile.components.profileFormDirective",["globalProfile.api.measurements"])),function(e){"use strict";e.controller("SidebarController",["$log","$scope","$state","people",function(e,i,t,r){i.$state=t,i.people=r,i.filterText="",i.clearFilter=function(){i.filterText=""}}])}(angular.module("globalProfile.states.admin")),function(e){"use strict";e.controller("SelectMinistryController",["$log","$scope","$state","session","systems",function(e,i,t,r,n){function o(e,i){var t=[];return angular.forEach(e,function(e){t.push(e),e.hasOwnProperty(i)&&angular.isArray(e[i])&&(t=t.concat(o(e[i],i)))}),t}var s=o(r.assignments,"sub_ministries");i.$state=t,i.ministries=n,i.isLeader=function(e){var i=_.pluck(_.where(s,{ministry_id:e}),"team_role");return _.contains(i,"leader")||_.contains(i,"inherited_leader")}}])}(angular.module("globalProfile.states.selectMinistry")),function(e){"use strict";e.controller("AddProfileController",["$log","$scope","$state","profile","ministry","Profile","ministries","countries","languages",function(e,i,t,r,n,o,s,a,l){i.$state=t,i.requiredFields=["email","last_name","first_name","gender","birth_date","marital_status","country_of_residence","language1","organizational_status","funding_source","date_joined_staff","ministry_of_employment","assignment_ministry","mcc","position_role","scope"],i.profile=angular.copy(r),i.ministries=s,i.countries=a,i.languages=l,i.resetForm=function(){i.profile=angular.copy(r)},i.saveProfile=function(){o.create({ministry_id:n.ministry_id},i.profile,function(e){t.go("admin.edit",{person_ID:e.person_id},{reload:!0})},function(){e.error("Error Saving Profile")})},i.$on("$stateChangeStart",function(e,r,n,o,s){i.profileForm.$dirty&&(e.preventDefault(),$modal.open({templateUrl:"js/states/admin/unsaved.modal.html",controller:["$scope","$modalInstance",function(e,i){e.save=function(){i.close()},e.cancel=function(){i.dismiss("discard")}}]}).result.then(function(){},function(e){"discard"===e&&(i.profileForm.$setPristine(),t.transitionTo(r,n))}))})}])}(angular.module("globalProfile.states.admin.add")),function(e){"use strict";e.controller("EditProfileController",["$log","$scope","$state","profile","ministry","Profile","$modal","ministries","countries","languages",function(e,i,t,r,n,o,s,a,l,u){i.$state=t,i.requiredFields=["email","last_name","first_name","gender","birth_date","marital_status","country_of_residence","language1","organizational_status","funding_source","date_joined_staff","ministry_of_employment","assignment_ministry","mcc","position_role","scope"],i.profile=angular.copy(r),i.ministries=a,i.countries=l,i.languages=u,i.resetForm=function(){i.profile=angular.copy(r),i.profileForm.$setPristine()},i.saveChanges=function(){o.update({ministry_id:n.ministry_id},i.profile,function(e){r=e,i.profile=angular.copy(r),i.profileForm.$setPristine()},function(){e.error("Error Saving Profile")})},i.$on("$stateChangeStart",function(e,r,n,o,a){i.profileForm.$dirty&&(e.preventDefault(),s.open({templateUrl:"js/states/admin/unsaved.modal.html",controller:["$scope","$modalInstance",function(e,i){e.save=function(){i.close()},e.cancel=function(){i.dismiss("discard")}}]}).result.then(function(){},function(e){"discard"===e&&(i.profileForm.$setPristine(),t.transitionTo(r,n))}))})}])}(angular.module("globalProfile.states.admin.edit")),function(e){"use strict";e.controller("ImportCSVController",["$log","$scope","$state","ministry","Profile",function(e,i,t,r,n){function o(){angular.isUndefined(i.file)||angular.isUndefined(i.hasHeader)||Papa.parse(i.file,{header:!1,complete:function(e,t){var r=[];i.$apply(function(){if(i.hasHeader){i.headerRow=e.data.shift();for(var t=0;t<i.headerRow.length;t++)r.push({index:t})}else{delete i.headerRow;for(var t=0;t<e.data[0].length;t++)r.push({index:t})}i.columns=r,i.csv=e})}})}i.$state=t,i.hasHeader=!0,i.columns=[],i.pager={page:1,begin:0},i.browse=function(){document.getElementById("fileBrowser").click()},i.$watch("file",function(e){angular.isUndefined(e)||o()}),i.$watch("hasHeader",function(e){o()}),i.$watch("pager.page",function(e){angular.isUndefined(i.csv)||(i.pager.begin=10*(e-1))})}])}(angular.module("globalProfile.states.admin.import")),function(e){"use strict";e.controller("EditPersonalProfileController",["$log","$scope","session","ministry","profile","Profile","ministries","countries","languages",function(e,i,t,r,n,o,s,a,l){i.profile=angular.copy(n),i.ministries=s,i.countries=a,i.languages=l,i.resetForm=function(){i.profile=angular.copy(n),i.profileForm.$setPristine()},i.saveChanges=function(){var e=angular.isUndefined(n.id)?"create":"update";o[e]({ministry_id:r.ministry_id},i.profile,function(e){n=e,i.profile=angular.copy(n),i.profileForm.$setPristine()})}}])}(angular.module("globalProfile.states.profile.edit"));
//# sourceMappingURL=app.min.js.map